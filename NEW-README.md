# Envara

`envara` is a small Python utility centered around the `Env` class, which
provides a minimal‑dependency engine for doing string expansions similar to
shells.

It can:

* expand environment variables in both POSIX (`$VAR`, `${VAR}`) and Windows
  (`%VAR%`) styles;
* substitute positional arguments (`$1`, `$2`, …) from a supplied list;
* expand user information (`~`), quoted strings and escaped characters
  (`\n`, `\t`, `\uNNNN`, etc.);
* strip line comments (`# …`) and control everything with bit flags;
* quote and unquote strings, handling escapes correctly;
* unescape text into its literal form;
* determine platform names and generate lists of supported or current
  platforms for use by other components (such as `EnvFile`).

The design goals are minimalism (no external dependencies) and portability
(Windows, POSIX, Risc OS, VMS, etc.).

---

## `Env` class members

### Class attributes

- `IS_POSIX`, `IS_WINDOWS`, `IS_VISCOS`, `IS_RISCOS` – booleans indicating the
  current OS family (derived from `os.sep`).
- `PLATFORM_POSIX`, `PLATFORM_WINDOWS` – textual markers used in platform
  queries.
- `PLATFORM_THIS` – the running platform as returned by
  `sys.platform.lower()`.
- `SPECIAL` – mapping of short escape sequences (`\n`, `\t`, …) to their
  character values; used by `unescape()` when an escape character precedes them.
- `__platform_map` – an internal dictionary mapping regex patterns to lists of
  platform names.  Used by the platform helper methods.

### Static methods

#### `expand(input, args=None, flags=None, ...)`

High‑level helper that:

1. optionally unquotes the string and strips spaces/comments;
2. optionally skips expansions inside single quotes or disables environment
   variables based on `EnvExpandFlags`;
3. dispatches to either `expand_posix()` or `expand_simple()` depending on the
   detected expansion character;
4. optionally unescapes the result.

Returns a tuple `(result, info)` where `info` is an `EnvParseInfo` instance
containing details of the parsing operation.

#### `expand_posix(input, args=None, vars=os.environ, ...)`

Performs POSIX‑style expansions (`$name`, `${name}`, arithmetic and command
substitutions) and argument substitution.  Behaviours are influenced by
`EnvExpandFlags`; `vars` defaults to the current environment unless skipped.

#### `expand_simple(input, args=None, vars=os.environ, ...)`

Simpler expansion engine primarily intended for Windows‑style variables.  Also
supports argument substitution and path‑style tests (`%~dp1`, etc.).

#### `get_all_platforms(flags=EnvPlatformFlags.NONE)`

Returns a list of every platform name known to the class.  Flags may cause an
empty string to be included.

#### `get_cur_platforms(flags=EnvPlatformFlags.NONE, prefix=None, suffix=None)`

Walks the internal platform map and returns platforms appropriate for the
running host, ordered from generic to specific.  Optional `prefix`/`suffix`
parameters decorate each entry (for example, to turn `"linux"` into
`".linux.env"`).

#### `quote(input, type=EnvQuoteType.DOUBLE, escape=None)`

Wraps the input string in the requested quote style, escaping internal
quotes/escape characters as needed.  Does **not** strip whitespace – the caller
must do that beforehand.

#### `unescape(input, escape=None, strip_blanks=False)`

Converts escape sequences such as `\n`, `\u0020` etc. back into their
corresponding characters.  Can optionally trim leading/trailing whitespace, and
will raise `ValueError` on malformed sequences.

#### `unquote(input, strip_spaces=True, ... )`

Removes surrounding quotes from a string, properly handling escaped quotes
and nested quoting rules.  Can also detect expansion characters, escape
characters and line‑comment cutters; returns both the unquoted result and an
`EnvParseInfo` describing what was found.  Throws `ValueError` if the string is
malformed (dangling escape or unterminated quote).

#### `__fail_unescape(input, beg_pos, end_pos)`

Internal helper that raises a `ValueError` when `unescape()` encounters an
incomplete escape sequence.

---

## Usage notes

The package exposes these expansion routines primarily for use by tools that
need to read `.env` files or similar configuration.  The `EnvFile` class in
`env_file.py` builds on `Env` to process files, apply platform filters, and
simulate shell‑like behaviour.

For command‑line usage, see the small `__main__` module which simply provides
a help message and delegates to `Env.expand`.

---

*This README was autogenerated from docstrings and comments in the `env.py`
source file.*
